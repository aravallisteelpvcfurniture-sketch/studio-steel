{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a furniture product offered by Aravalli Home Studio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., chair, table)."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "category"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order placed through the app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, processing, shipped, delivered)."
        },
        "orderItems": {
          "type": "array",
          "description": "Array of order items in the order.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "status",
        "orderItems"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "unitPrice": {
          "type": "number",
          "description": "Price of one unit of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "unitPrice"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer who uses the app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Greeting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Greeting",
      "type": "object",
      "description": "Represents a greeting message displayed to visitors.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the greeting message."
        },
        "message": {
          "type": "string",
          "description": "The greeting message text."
        },
        "type": {
          "type": "string",
          "description": "Type of greeting (e.g., welcome, returning)."
        },
        "startDate": {
          "type": "string",
          "description": "Start date for displaying the greeting.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date for displaying the greeting.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "message",
        "type",
        "startDate",
        "endDate"
      ]
    },
    "GalleryItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GalleryItem",
      "type": "object",
      "description": "Represents an item (image or video) in the gallery.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the gallery item."
        },
        "title": {
          "type": "string",
          "description": "Title of the gallery item."
        },
        "description": {
          "type": "string",
          "description": "Description of the gallery item."
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the media file (image or video).",
          "format": "uri"
        },
        "mediaType": {
          "type": "string",
          "description": "Type of media (e.g., image, video)."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "mediaUrl",
        "mediaType"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a product recommendation for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Recommendation)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Recommendation)"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the recommendation (e.g., browsing history, previous orders)."
        }
      },
      "required": [
        "id",
        "customerId",
        "productId",
        "reason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores furniture products offered by Aravalli Home Studio.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores customer orders. Orders are stored as a subcollection of the user document to ensure path-based ownership. Includes customerId for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores order items associated with a specific order.  Order items are stored as a subcollection to Orders.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Uses the Firebase Authentication UID as the document ID.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer), matching the Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/greetings/{greetingId}",
        "definition": {
          "entityName": "Greeting",
          "schema": {
            "$ref": "#/backend/entities/Greeting"
          },
          "description": "Stores greeting messages displayed to visitors.",
          "params": [
            {
              "name": "greetingId",
              "description": "Unique identifier for the greeting message."
            }
          ]
        }
      },
      {
        "path": "/gallery_items/{galleryItemId}",
        "definition": {
          "entityName": "GalleryItem",
          "schema": {
            "$ref": "#/backend/entities/GalleryItem"
          },
          "description": "Stores gallery items (images and videos) showcasing furniture and installations.",
          "params": [
            {
              "name": "galleryItemId",
              "description": "Unique identifier for the gallery item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores product recommendations for users. Stored as a subcollection under the user document for path-based ownership. Includes customerId for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user (customer)."
            },
            {
              "name": "recommendationId",
              "description": "Unique identifier for the recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support Aravalli Home Studio's core features, including product catalog, order placement, gallery, user authentication, and AI-powered recommendations. It emphasizes security, scalability, and debuggability by adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity.\\n\\n**Authorization Independence:**\\n\\n*   Customer-owned data (Orders, Recommendations) are placed under `/users/{userId}`. This ensures clear ownership and avoids the need for complex `get()` calls in security rules. The `customerId` field within the `orders` and `recommendations` subcollections of `/users/{userId}` provides authorization context. \\n\\n**Structural Segregation:**\\n\\n*   Products, GalleryItems and Greetings are stored in root-level collections (`/products`, `/gallery_items`, `/greetings`), indicating a global scope with potentially different security requirements (e.g., read access for all users).  Different collections are used to keep data with different access needs isolated.\\n\\n**Access Modeling:**\\n\\n*   Private data is stored under the `/users/{userId}` path, enabling path-based ownership. Orders and Recommendations are located in subcollections under the user's document.\\n\\n**QAPs (Rules are not Filters):**\\n\\n*   The segregation of data based on ownership and scope (public vs. private) facilitates secure list operations. Rules can easily enforce that users can only list their own orders and recommendations, while allowing anyone to list products and gallery items. For listings products, pagination can be implemented to avoid overwhelming the client with large datasets.  Because authorization data is not stored hierarchically, it will also avoid using Rules as Filters, ensuring efficient data retrieval.\\n\\nThis structure allows for straightforward and secure Firestore rules that minimize `get()` calls, prevent rule-based filtering, and provide a scalable and debuggable backend."
  }
}