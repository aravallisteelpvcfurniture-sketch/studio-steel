{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a furniture product offered by Aravalli Home Studio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., chair, table)."
        },
        "material": {
          "type": "string",
          "description": "Material of the product (e.g., steel, PVC)."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "category",
        "material"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, processing, shipped, completed)."
        },
        "shippingAddress": {
          "type": "string",
          "description": "Shipping address for the order."
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "status",
        "shippingAddress"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "itemPrice": {
          "type": "number",
          "description": "Price of the individual item"
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "itemPrice"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of Aravalli Home Studio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "address"
      ]
    },
    "GalleryItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GalleryItem",
      "type": "object",
      "description": "Represents an item in the gallery (image or video).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the gallery item."
        },
        "title": {
          "type": "string",
          "description": "Title of the gallery item."
        },
        "description": {
          "type": "string",
          "description": "Description of the gallery item."
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the image or video.",
          "format": "uri"
        },
        "mediaType": {
          "type": "string",
          "description": "Type of media (e.g., image, video)."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "mediaUrl",
        "mediaType"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a recommended product for a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Recommendation)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Recommendation)"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the recommendation (e.g., browsing history, previous order)."
        }
      },
      "required": [
        "id",
        "customerId",
        "productId",
        "reason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores furniture product information.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profile information.  Customers can only access their own profile.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores customer order information. Orders are a subcollection of Customer to enforce ownership.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual order items within a specific order. OrderItems are subcollections of Orders.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/galleryItems/{galleryItemId}",
        "definition": {
          "entityName": "GalleryItem",
          "schema": {
            "$ref": "#/backend/entities/GalleryItem"
          },
          "description": "Stores gallery items (images, videos) available to all users.",
          "params": [
            {
              "name": "galleryItemId",
              "description": "Unique identifier for the gallery item."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores product recommendations for individual customers. Recommendations are a subcollection of Customer to enforce ownership.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "recommendationId",
              "description": "Unique identifier for the recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support Aravalli Home Studio's core features, emphasizing security, scalability, and ease of debugging.  It leverages path-based ownership and denormalization to ensure authorization independence. The structure is segregated by entity type, aligning with the principle of homogeneous security posture, where each collection has a distinct and predictable security requirements.\n\n*   **Products Collection:** Stores product information, accessible for reading by all users (for catalog display). Write access is restricted to admins (not implemented here).\n*   **Customers Collection:** Stores customer profiles. Customers can only read/write their own profiles. This uses path-based ownership (`/users/{userId}/...`).\n*   **Orders and OrderItems Collections:** Orders are stored as subcollections under the respective customer document (`/customers/{customerId}/orders/{orderId}`).  This enforces ownership and simplifies security rules for orders and order items.  OrderItems are stored as subcollections of Orders.\n*   **GalleryItems Collection:** Stores image and video gallery items.  These are readable by everyone.\n*   **Recommendations Collection:** Recommendations are stored as subcollections under the customer documents to whom they are recommended. (`/customers/{customerId}/recommendations/{recommendationId}`).\n\n**Authorization Independence:**  Achieved through path-based ownership. For example, orders and recommendations are subcollections of customers, ensuring that security rules can be written based on the `request.auth.uid` matching the `customerId` segment of the path, without needing `get()` calls to parent documents.\n\n**QAPs Support:**\n*   Secure `list` operations are facilitated by the segregation of data into different collections with well-defined access control policies. Only admins can `list` all products, and users can only `list` orders associated with their customer ID. This segregation, combined with appropriate security rules, prevents unauthorized data listing.\n*   Path-based ownership secures user data.  A user can only access data under their `/customers/{customerId}` path, so listing resources from `/customers/{customerId}/orders` will only return their orders."
  }
}
    