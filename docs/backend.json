{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a furniture product offered by Aravalli Home Studio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "material": {
          "type": "string",
          "description": "The material the product is made of (e.g., steel, PVC)."
        },
        "category": {
          "type": "string",
          "description": "Category of the product (e.g., chair, table)."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "material",
        "category"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Aravalli Home Studio application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., pending, processing, shipped, delivered)."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "status"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product for this order item."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "VisitorGreeting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VisitorGreeting",
      "type": "object",
      "description": "Represents a greeting message for visitors.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the visitor greeting."
        },
        "message": {
          "type": "string",
          "description": "The greeting message to display."
        },
        "type": {
          "type": "string",
          "description": "The type of visitor greeting (e.g., new visitor, returning visitor)."
        }
      },
      "required": [
        "id",
        "message",
        "type"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a product recommendation for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Recommendation)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Recommendation)"
        },
        "reason": {
          "type": "string",
          "description": "The reason for the product recommendation."
        }
      },
      "required": [
        "id",
        "userId",
        "productId",
        "reason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Accessible to all users for reading.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Only the user can read/write their own data.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user, matching Firebase auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders placed by a user. Only the user can access their own orders.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user, matching Firebase auth UID."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores order items associated with a specific order. Accessible only with a valid orderId.",
          "params": [
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/visitorGreetings/{greetingId}",
        "definition": {
          "entityName": "VisitorGreeting",
          "schema": {
            "$ref": "#/backend/entities/VisitorGreeting"
          },
          "description": "Stores greeting messages for visitors. Accessible to all users for reading.",
          "params": [
            {
              "name": "greetingId",
              "description": "Unique identifier for the visitor greeting."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores product recommendations for a user. Only the user can access their own recommendations.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "recommendationId",
              "description": "Unique identifier for the recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure, scalable, and easily maintainable backend for the Aravalli Home Studio application. The structure prioritizes authorization independence through denormalization and structural segregation to ensure security and simplify rules. Path-based ownership is used where appropriate, and membership maps are utilized for collaborative data access.\n\n*   **Authorization Independence:** User ownership is enforced using hierarchical paths (e.g., `/users/{userId}/orders/{orderId}`). No `get()` calls are needed in security rules to validate ownership.\n\n*   **Structural Segregation:** Each top-level collection serves a specific purpose, ensuring documents within a collection have similar access control requirements.\n\n*   **QAPs (Rules are not Filters):**  The structure enables secure `list` operations. For example, only the user who owns an order can list their orders by querying the `/users/{userId}/orders` collection. Publicly accessible data, such as products and visitor greetings, resides in separate collections that can be read by anyone.\n\n*   **DBAC (No Custom Claims):** User roles are managed through the Firebase Authentication system and user IDs (`request.auth.uid`) are used to validate access in the security rules.\n\nThe error reported in the console `FirebaseError: Firebase: Error (auth/operation-not-allowed)` suggests an issue with Firebase Authentication configuration. Ensure that the 'password' and 'anonymous' providers are enabled in the Firebase Console under Authentication > Sign-in method. Also, verify that there are no restrictions enabled that are preventing the operation."
  }
}
