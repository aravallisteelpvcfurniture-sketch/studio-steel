{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a furniture product in the catalog.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "material": {
          "type": "string",
          "description": "Material of the product (e.g., Steel, PVC)."
        },
        "dimensions": {
          "type": "string",
          "description": "Dimensions of the product."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "material",
        "dimensions"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date when the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Status of the order (e.g., Pending, Processing, Shipped, Delivered)."
        },
        "orderItems": {
          "type": "array",
          "description": "Order Items",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "totalAmount",
        "status",
        "orderItems"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "unitPrice": {
          "type": "number",
          "description": "Price of one unit of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "unitPrice"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer of Aravalli Home Studio.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the customer."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the customer."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "address": {
          "type": "string",
          "description": "Address of the customer."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone",
        "address"
      ]
    },
    "GalleryItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GalleryItem",
      "type": "object",
      "description": "Represents an item in the gallery (image or video).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the gallery item."
        },
        "title": {
          "type": "string",
          "description": "Title of the gallery item."
        },
        "description": {
          "type": "string",
          "description": "Description of the gallery item."
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the image or video.",
          "format": "uri"
        },
        "mediaType": {
          "type": "string",
          "description": "Type of media (e.g., image, video)."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "mediaUrl",
        "mediaType"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a product recommendation for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recommendation."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to Customer. (Relationship: Customer 1:N Recommendation)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Recommendation)"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the recommendation (e.g., based on browsing history, previous orders)."
        }
      },
      "required": [
        "id",
        "customerId",
        "productId",
        "reason"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. No specific authorization rules are applied here, as it is assumed that all products are publicly accessible.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer profiles. Only the authenticated customer can access their own profile. It serves as a root collection for storing orders and recommendations related to a particular customer.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores customer orders.  Only the authenticated customer can access their own orders. Path-based ownership ensures that only the customer who owns the order can read or write to it.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores the items of an order. Only the customer who owns the order can read or write to it.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores product recommendations for a specific customer. Only the authenticated customer can access their own recommendations. Path-based ownership ensures that only the customer who owns the recommendations can read or write to them.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            },
            {
              "name": "recommendationId",
              "description": "Unique identifier for the recommendation."
            }
          ]
        }
      },
      {
        "path": "/galleryItems/{galleryItemId}",
        "definition": {
          "entityName": "GalleryItem",
          "schema": {
            "$ref": "#/backend/entities/GalleryItem"
          },
          "description": "Stores gallery items (images, videos). No specific authorization rules are applied here, as it is assumed that all gallery items are publicly accessible.",
          "params": [
            {
              "name": "galleryItemId",
              "description": "Unique identifier for the gallery item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support Aravalli Home Studio's core features, including product catalog, order placement, gallery, user authentication, and AI-powered recommendations, all while prioritizing security and scalability. The structure adheres to the principles of Authorization Independence, Clarity of Intent, DBAC (Database Authenticated Control), and QAPs (Rules are not Filters).\n\n**Authorization Independence:**\nAuthorization independence is achieved via path-based ownership for user-specific data. For collaborative data, the membership map approach is adopted.\n\n**Structural Segregation:**\nThe structure segregates data with different access needs. For example, customer-owned data (orders, recommendations) are stored under `/customers/{customerId}`, while public product information is stored in the `/products` collection.\n\n**Access Modeling:**\n*   **Private Data:** Orders and Recommendations are placed within the customer document.\n*   **Hierarchical Paths:** User-owned data like orders and recommendations are organized using hierarchical paths: `/customers/{customerId}/orders/{orderId}` and `/customers/{customerId}/recommendations/{recommendationId}`.\n\n**QAPs Support:**\n*   The segregation of products and customer data allows for secure `list` operations. Listing products does not require any authorization checks, while listing orders requires authentication and authorization to ensure only the customer or authorized personnel can access the data.\n*   Storing customer-specific data under `/customers/{customerId}` enables secure `list` operations, ensuring that only the authenticated customer can access their own data.\n\n**Invariants:**\nThe structure supports the integrity of ownership by using path-based ownership. Timestamps can be enforced via rules to ensure correct order dates. Data consistency is maintained via denormalization."
  }
}